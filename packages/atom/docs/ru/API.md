# Справочник API Atom (Core)

**Atom** — это высокоуровневый оркестратор, который превращает обычные TypeScript/JavaScript классы в реактивные модели данных.

## `Atom.define(Model, options)` — Компиляция

Основной метод для создания репозитория атомов. Он анализирует класс (компилирует схему) один раз и возвращает объект-репозиторий для быстрого создания экземпляров.

### Параметры
- **`Model`**: Класс модели.
- **`options`**: Опции компиляции (имя, realm, плагины).

### Возвращает: `AtomRepository`

Репозиторий имеет методы:
- **`.create(args?, options?)`**: Создает новый анонимный экземпляр.
- **`.get(idOrObj?)`**: Возвращает существующий экземпляр по ID или создает новый (Identity Map). Если ID не передан, возвращает синглтон.
- **`.decay(id)`**: Уничтожает экземпляр по ID.
- **`.clear()`**: Уничтожает все экземпляры.

```typescript
const User = Atom.define(UserModel);
const admin = User.get('admin');
```

## `Atom(Model, options)` — Быстрое создание

Сокращение для `Atom.define(Model, options).create(args, options)`. Удобно для одноразовых атомов, но менее эффективно при массовом создании, так как может создавать новую фабрику, если не кеширована.

---

## Опции (AtomOptions)

### Опции (AtomOptions)
- **`name`** *(string)*: Имя модели (используется для отладки и формирования ID событий).
- **`realm`** *(string)*: Область видимости Quantum Bus (по умолчанию `root`).
- **`nuclearKind`** *(NuclearKindSelector)*: Глобальный тип нуклонов по умолчанию для всех свойств модели.
- **`constructorArgs`** *(any[])*: Аргументы, которые будут переданы в конструктор класса при создании.
- **`emitChanges`** *(boolean)*: Если true, каждое изменение свойства будет транслироваться в Quantum Bus.
- **`emitChangeName`** *(string)*: Кастомное имя события.
- **`plugins`** *(AtomPlugin[])*: Массив локальных плагинов для этого экземпляра.

---

## Поведение Экземпляра (Proxy)

### 1. Свойства -> Нуклоны
Каждое поле класса автоматически становится реактивным нуклоном (`Nucl`).
- **Чтение**: `atom.count` возвращает значение.
- **Запись**: `atom.count = 5` обновляет нуклон и уведомляет подписчиков.

### 2. Доступ к сырым нуклонам (`$prop`)
Вы можете получить доступ к самому объекту нуклона (для использования методов `.up()`, `.push()`, `.silent()` и т.д.), добавив префикс `$` к имени свойства.

```typescript
const store = Atom(class { count = 0 });
store.$count.up(v => console.log(v));
```

### 3. Контекст управления (`$`)
Свойство `$` (одиночный символ доллара) открывает доступ к контексту управления атомом.

#### Свойства контекста (`atom.$`):
- **`.bus`**: Ссылка на `RealmBus` этой модели.
- **`.on(event, listener)`**: Подписка на события в шине с автоматической очисткой.
- **`.addDisposer(fn)`**: Регистрация функции очистки.
- **`.decay()`**: Полное уничтожение экземпляра.

---

## Базовый класс `IAtomic`

Для обеспечения автокомплита и корректной типизации рекомендуется расширять абстрактный класс `IAtomic`.

```typescript
import { Atom, IAtomic } from '@alaq/atom';

class UserStore extends IAtomic<UserStore> {
  name = 'Ivan';
}
const user = Atom(UserStore);
```

---

## Плагины и расширения

- [Система плагинов Atom](./API_PLUGINS.md)
- [Вычисляемые свойства (Computed)](./API_PLUGIN_COMPUTED.md)
- [Автоматические подписки (Conventions)](./API_PLUGIN_CONVENTIONS.md)