Архитектура Nucl

  Основные компоненты

  1. Ядро (quark)
   - Основной реактивный примитив
   - Оптимизирован для производительности
   - Поддерживает флаги: HAS_LISTENERS, HAS_EVENTS, HAS_REALM, WAS_SET, DEDUP, STATELESS, SILENT

  2. Nucl (расширение quark)
   - Плагинная система для расширения функциональности
   - Глубокое отслеживание изменений через Proxy
   - Опциональная иммутабельность значений

  Новые флаги
   - IMMUTABLE - включает опциональную иммутабельность
   - DEEP_TRACKING - включает глубокое отслеживание изменений

  Внутреннее API
   - ._rawValue - оригинальное значение
   - ._state - прокси-обертка (при включенном DEEP_TRACKING)
   - value геттер - возвращает _state при DEEP_TRACKING, иначе _rawValue

  Плагины
   - Nucl.useRealmPlugins(...plugins[]) - установка плагинов глобально для всех nucl в realm
   - Nucl({plugins: [...]}) - установка плагинов индивидуально для одного nucl

  Шина событий (bus)
   - bus.emit(event, data) - отправка события в realm
   - bus.on(event, handler) - подписка на события
   - bus.off(event, handler) - отписка

  Глубокое отслеживание
   - Реализуется через Proxy
   - Оборачивает вложенные объекты/массивы рекурсивно при доступе
   - Использует WeakMap для кэширования прокси-объектов
   - При изменении вложенных свойств вызывает обновление nucl

  Иммутабельность
   - Включается через флаг IMMUTABLE
   - При обновлении создает новые копии объектов/массивов
   - Возможна опциональная заморозка объектов через Object.freeze()

  Совместимость
   - Сохраняется обратная совместимость с существующим API
   - Все новые функции опциональны и включаются через флаги/опции
   - Архитектура позволяет легковесно использовать только необходимый функционал