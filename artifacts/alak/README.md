# Alak v5

> **Внимание:** Это документация для устаревающей версии 5. Для новой версии используйте соответствующий тег или документацию.

## Установка

Для установки версии 5 используйте команду:

```bash
npm i alak@5
```

## Документация модулей

Подробную документацию по модулям можно найти по ссылкам (в исходном репозитории):

- [@packages/alak/README.md](packages/alak/README.md)
- [@packages/atom/README.md](packages/atom/README.md)
- [@packages/nucleus/README.md](packages/nucleus/README.md)

## Пример использования (Модель и Подписки)

В версии 5 модель (класс атома) поддерживает автоматические подписки через именование методов.

### Методы инициализации

При инициализации атома вызывается событие `INIT`. Вы можете определить метод `_on_INIT`, чтобы выполнить код в момент старта.

```javascript
class MyModel {
  // Вызывается при инициализации атома
  _on_INIT(data) {
    console.log('Атом инициализирован', data);
  }
}
```

### Функции-подписки

Методы класса могут автоматически подписываться на события и изменения данных (нуклеусов), следуя специальным соглашениям об именовании.

#### 1. Подписка на события шины (`_on_`)

Методы, начинающиеся с `_on_`, подписываются на соответствующие события в шине данных атома.

```javascript
// Подписка на событие 'USER_LOGIN'
_on_USER_LOGIN(payload) {
  console.log('Пользователь вошел:', payload);
}
```

#### 2. Подписка на локальные нуклеусы (`_ИмяНуклеуса_Тип`)

Методы, начинающиеся с `_` (но не `_on_` и не `_$`), подписываются на изменения состояния **этого же** атома.
Формат: `_ИмяНуклеуса_ТипПодписки`

*   `ИмяНуклеуса`: имя свойства в `state` или `core`.
*   `ТипПодписки`: например, `up` (обновление).

```javascript
// state = { count: 0 }
// Подписка на обновление 'count'
_count_up(value) {
  console.log('Счетчик изменился:', value);
}
```

#### 3. Подписка на внешние атомы (`_$ИмяАтома_ИмяНуклеуса_Тип`)

Методы, начинающиеся с `_$`, подписываются на изменения в **других** атомах, доступных через фасад.
Формат: `_$ИмяАтома_ИмяНуклеуса_ТипПодписки`

```javascript
// Подписка на нуклеус 'theme' в атоме 'Settings'
_$Settings_theme_up(theme) {
  console.log('Тема изменилась в настройках:', theme);
}
```

### Полный пример модели

```javascript
export class CounterModel {
  state = {
    count: 0
  };

  // Инициализация
  _on_INIT() {
    console.log('CounterModel готов');
  }

  // Реакция на изменение собственного count
  _count_up(val) {
    if (val > 10) {
      this.core.count(0); // Сброс через core
    }
  }

  // Реакция на событие RESET_ALL
  _on_RESET_ALL() {
    this.core.count(0);
  }

  // Реакция на изменение user в атоме Auth
  _$Auth_user_up(user) {
    console.log('Пользователь изменился, сбрасываем счетчик');
    this.core.count(0);
  }
}
```
